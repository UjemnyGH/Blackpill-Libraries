#ifndef __ANALOG_TO_DIGITAL_CONVERTER_
#define __ANALOG_TO_DIGITAL_CONVERTER_

#include "rcc.h"

struct ADC {
    io32 state;
    io32 control1;
    io32 control2;
    io32 sampleTime1;
    io32 sampleTime2;
    io32 injectedChannelDataOffset1;
    io32 injectedChannelDataOffset2;
    io32 injectedChannelDataOffset3;
    io32 injectedChannelDataOffset4;
    io32 higherThreshold;
    io32 lowerThreshold;
    io32 regularSequence1;
    io32 regularSequence2;
    io32 regularSequence3;
    io32 injectedSequence;
    io32 injectedData1;
    io32 injectedData2;
    io32 injectedData3;
    io32 injectedData4;
    io32 data;
};

#define InitADC ResetClockControl->apb1Enable |= 0x10
#define InitADCLowPower ResetClockControl->apb1LowPowerEnable |= 0x10

#define AnalogToDigital ((struct ADC *)ADC1_BASE)

#define ADC_CommonControlRegister (*(ion32*)ADC1_BASE + 0x304)

#define ADC_COMMON_CONTROL_PRESCALER_2  0x0
#define ADC_COMMON_CONTROL_PRESCALER_4  0x10000
#define ADC_COMMON_CONTROL_PRESCALER_6  0x20000
#define ADC_COMMON_CONTROL_PRESCALER_8  0x30000

#define ADC_STATE_OVERRUN           0x20
#define ADC_STATE_REGULAR_CH_START  0x10
#define ADC_STATE_INJECTED_CH_START 0x8
#define ADC_STATE_INJECTED_CH_EOC   0x4
#define ADC_STATE_REGULAR_CH_EOC    0x2
#define ADC_STATE_ANALOG_WATCHDOG   0x1

#define ADC_CONTROL1_OVERRUN_INT_ENABLE         0x4000000
#define ADC_CONTROL1_RESOLUTION_12BIT           (0 << 24) 
#define ADC_CONTROL1_RESOLUTION_10BIT           0x1000000 
#define ADC_CONTROL1_RESOLUTION_8BIT            0x2000000 
#define ADC_CONTROL1_RESOLUTION_6BIT            0x3000000

#define ADC_CONTROL1_ANALOG_WATHCDOG_ENABLE_REGULAR     0x800000
#define ADC_CONTROL1_ANALOG_WATCHDOG_ENABLE_INJJECTED   0x400000
#define ADC_CONTROL1_DISCOUNT_MODE_1CHANNEL             (0 << 13)
#define ADC_CONTROL1_DISCOUNT_MODE_2CHANNEL             0x2000
#define ADC_CONTROL1_DISCOUNT_MODE_3CHANNEL             0x4000
#define ADC_CONTROL1_DISCOUNT_MODE_4CHANNEL             0x6000
#define ADC_CONTROL1_DISCOUNT_MODE_5CHANNEL             0x8000
#define ADC_CONTROL1_DISCOUNT_MODE_6CHANNEL             0xa000
#define ADC_CONTROL1_DISCOUNT_MODE_7CHANNEL             0xc000
#define ADC_CONTROL1_DISCOUNT_MODE_8CHANNEL             0xe000

#define ADC_CONTROL1_DISCOUNT_MODE_INJECTED_CH          0x1000
#define ADC_CONTROL1_DISCOUNT_MODE_REGULAR_CH           0x800
#define ADC_CONTROL1_AUTO_INJECTED_CONVERSION           0x400
#define ADC_CONTROL1_ENABLE_WATCHDOG_SINGLE_CH_SCAN_MODE    0x200
#define ADC_CONTROL1_SCAN_MODE                          0x100
#define ADC_CONTROL1_INTERRUPT_ENABLE_INJECTED_CH       0x80
#define ADC_CONTROL1_INTERRUPT_ENABLE_ANALOG_WATCHDOG   0x40
#define ADC_CONTROL1_INTERRUPT_ENABLE_EOC               0x20

#define ADC_CONTROL1_ANALOG_INPUT_CH0                   0x0
#define ADC_CONTROL1_ANALOG_INPUT_CH1                   0x1
#define ADC_CONTROL1_ANALOG_INPUT_CH2                   0x2
#define ADC_CONTROL1_ANALOG_INPUT_CH3                   0x3
#define ADC_CONTROL1_ANALOG_INPUT_CH4                   0x4
#define ADC_CONTROL1_ANALOG_INPUT_CH5                   0x5
#define ADC_CONTROL1_ANALOG_INPUT_CH6                   0x6
#define ADC_CONTROL1_ANALOG_INPUT_CH7                   0x7
#define ADC_CONTROL1_ANALOG_INPUT_CH8                   0x8
#define ADC_CONTROL1_ANALOG_INPUT_CH9                   0x9
#define ADC_CONTROL1_ANALOG_INPUT_CH10                  0xa
#define ADC_CONTROL1_ANALOG_INPUT_CH11                  0xb
#define ADC_CONTROL1_ANALOG_INPUT_CH12                  0xc
#define ADC_CONTROL1_ANALOG_INPUT_CH13                  0xd
#define ADC_CONTROL1_ANALOG_INPUT_CH14                  0xe
#define ADC_CONTROL1_ANALOG_INPUT_CH15                  0xf
#define ADC_CONTROL1_ANALOG_INPUT_CH16                  0x10

#define ADC_CONTROL2_START_CONVERSATION_REG_CH                  0x40000000
#define ADC_CONTROL2_EXTERNAL_TRIGGER_ENABLE_REG_CH_RISING      0x10000000
#define ADC_CONTROL2_EXTERNAL_TRIGGER_ENABLE_REG_CH_FALLING     0x20000000
#define ADC_CONTROL2_EXTERNAL_TRIGGER_ENABLE_REG_CH_BOTH        0x30000000
#define ADC_CONTROL2_EXTERNAL_EVENT_TIMER1_CC1_EVENT            0x0000000
#define ADC_CONTROL2_EXTERNAL_EVENT_TIMER1_CC2_EVENT            0x1000000
#define ADC_CONTROL2_EXTERNAL_EVENT_TIMER1_CC3_EVENT            0x2000000
#define ADC_CONTROL2_EXTERNAL_EVENT_TIMER2_CC2_EVENT            0x3000000
#define ADC_CONTROL2_EXTERNAL_EVENT_TIMER2_CC3_EVENT            0x4000000
#define ADC_CONTROL2_EXTERNAL_EVENT_TIMER2_CC4_EVENT            0x5000000
#define ADC_CONTROL2_EXTERNAL_EVENT_TIMER2_TRGO_EVENT           0x6000000
#define ADC_CONTROL2_EXTERNAL_EVENT_TIMER3_CC1_EVENT            0x7000000
#define ADC_CONTROL2_EXTERNAL_EVENT_TIMER3_TRGO_EVENT           0x8000000
#define ADC_CONTROL2_EXTERNAL_EVENT_TIMER4_CC4_EVENT            0x9000000
#define ADC_CONTROL2_EXTERNAL_EVENT_TIMER5_CC1_EVENT            0xa000000
#define ADC_CONTROL2_EXTERNAL_EVENT_TIMER5_CC2_EVENT            0xb000000
#define ADC_CONTROL2_EXTERNAL_EVENT_TIMER5_CC3_EVENT            0xc000000
#define ADC_CONTROL2_EXTERNAL_EXTI_LINE11                       0xf000000

#define ADC_CONTROL2_START_CONVERSATION_INJ_CH                  0x400000
#define ADC_CONTROL2_EXTERNAL_TRIGGER_ENABLE_INJ_CH_RISING      0x100000
#define ADC_CONTROL2_EXTERNAL_TRIGGER_ENABLE_INJ_CH_FALLING     0x200000
#define ADC_CONTROL2_EXTERNAL_TRIGGER_ENABLE_INJ_CH_BOTH        0x300000
#define ADC_CONTROL2_EXTERNAL_EVENT_TIMER1_CC4_EVENT_INJ            0x00000
#define ADC_CONTROL2_EXTERNAL_EVENT_TIMER1_TRGO_EVENT_INJ           0x10000
#define ADC_CONTROL2_EXTERNAL_EVENT_TIMER2_CC1_EVENT_INJ            0x20000
#define ADC_CONTROL2_EXTERNAL_EVENT_TIMER2_TRGO_EVENT_INJ           0x30000
#define ADC_CONTROL2_EXTERNAL_EVENT_TIMER3_CC2_EVENT_INJ            0x40000
#define ADC_CONTROL2_EXTERNAL_EVENT_TIMER3_CC4_EVENT_INJ            0x50000
#define ADC_CONTROL2_EXTERNAL_EVENT_TIMER4_CC1_EVENT_INJ            0x60000
#define ADC_CONTROL2_EXTERNAL_EVENT_TIMER4_CC2_EVENT_INJ            0x70000
#define ADC_CONTROL2_EXTERNAL_EVENT_TIMER4_CC3_EVENT_INJ            0x80000
#define ADC_CONTROL2_EXTERNAL_EVENT_TIMER4_TRGO_EVENT_INJ           0x90000
#define ADC_CONTROL2_EXTERNAL_EVENT_TIMER5_CC4_EVENT_INJ            0xa0000
#define ADC_CONTROL2_EXTERNAL_EVENT_TIMER5_TRGO_EVENT_INJ           0xb0000
#define ADC_CONTROL2_EXTERNAL_EXTI_LINE15_INJ                       0xf0000

#define ADC_CONTROL2_DATA_LEFT_ALIGNMENT                0x800
#define ADC_CONTROL2_EOC_CONVERSATION                   0x400
#define ADC_CONTROL2_DMA_DISABLE                        0x200
#define ADC_CONTROL2_DMA_MODE_ENABLE                    0x100
#define ADC_CONTROL2_CONTINOUS_CONVERSATION             0x2
#define ADC_CONTROL2_ENABLE_ADC                         0x1

#define ADC_SAMPLE_TIME_3_CYCLES            0x0
#define ADC_SAMPLE_TIME_15_CYCLES           0x1
#define ADC_SAMPLE_TIME_28_CYCLES           0x2
#define ADC_SAMPLE_TIME_56_CYCLES           0x3
#define ADC_SAMPLE_TIME_84_CYCLES           0x4
#define ADC_SAMPLE_TIME_112_CYCLES          0x5
#define ADC_SAMPLE_TIME_144_CYCLES          0x6
#define ADC_SAMPLE_TIME_4800_CYCLES         0x7

#define ADC_SEQUENCE1_REGULAR_LENGTH_1      0x0
#define ADC_SEQUENCE1_REGULAR_LENGTH_2      0x100000
#define ADC_SEQUENCE1_REGULAR_LENGTH_3      0x200000
#define ADC_SEQUENCE1_REGULAR_LENGTH_4      0x300000
#define ADC_SEQUENCE1_REGULAR_LENGTH_5      0x400000
#define ADC_SEQUENCE1_REGULAR_LENGTH_6      0x500000
#define ADC_SEQUENCE1_REGULAR_LENGTH_7      0x600000
#define ADC_SEQUENCE1_REGULAR_LENGTH_8      0x700000
#define ADC_SEQUENCE1_REGULAR_LENGTH_9      0x800000
#define ADC_SEQUENCE1_REGULAR_LENGTH_10     0x900000
#define ADC_SEQUENCE1_REGULAR_LENGTH_11     0xa00000
#define ADC_SEQUENCE1_REGULAR_LENGTH_12     0xb00000
#define ADC_SEQUENCE1_REGULAR_LENGTH_13     0xc00000
#define ADC_SEQUENCE1_REGULAR_LENGTH_14     0xd00000
#define ADC_SEQUENCE1_REGULAR_LENGTH_15     0xe00000
#define ADC_SEQUENCE1_REGULAR_LENGTH_16     0xf00000

#define ADC_SEQUENCE_INJECTED_LENGTH_1      0x0
#define ADC_SEQUENCE_INJECTED_LENGTH_2      0x100000
#define ADC_SEQUENCE_INJECTED_LENGTH_3      0x200000
#define ADC_SEQUENCE_INJECTED_LENGTH_4      0x300000

#define fetchDataRegularADC AnalogToDigital->control2 |= ADC_CONTROL2_START_CONVERSATION_REG_CH; while(AnalogToDigital->state & ADC_STATE_REGULAR_CH_EOC)
#define getDataADC AnalogToDigital->data

#endif